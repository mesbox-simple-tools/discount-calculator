<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng C·ª• T√≠nh % Discount T·ªëi ∆Øu Cho Seller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for professional look and feel */
        body {
            /* √Åp d·ª•ng font Inter cho to√†n b·ªô trang */
            font-family: 'Inter', sans-serif; 
            background-color: #f7f9fc;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-radius: 12px;
        }
        .metric-card {
            border: 1px solid; /* Defined by class colors */
            background-color: #ffffff;
            transition: all 0.3s ease;
            border-radius: 12px; /* Ensure rounded corners */
        }
        .metric-card:hover {
            box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.1), 0 4px 6px -4px rgba(99, 102, 241, 0.1);
        } 
        input[type="number"] {
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            transition: all 0.2s;
            background-color: white;
        }
        input[type="number"]:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
            outline: none;
        }
        /* Override default metric-card style for specific elements defined in HTML */
        .metric-card.default {
            border-color: #e0e7ff;
            background-color: #ffffff;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 mb-2">
                üí∞ C√¥ng C·ª• T√≠nh % Discount T·ªëi ∆Øu Cho Seller
            </h1>
            <p class="text-lg text-gray-600">
                S·ª≠ d·ª•ng template n√†y ƒë·ªÉ t√≠nh m·ª©c gi·∫£m gi√° Nhanh ‚Äì Chu·∫©n ‚Äì C√≥ L√£i tr√™n c√°c k√™nh b√°n h√†ng online
            </p>
        </header>

        <div class="space-y-10">

            <div class="card bg-white p-6 md:p-8">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    1. NH·∫¨P D·ªÆ LI·ªÜU ƒê·∫¶U V√ÄO ƒê·ªÇ T√çNH TO√ÅN
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="cogs">Gi√° v·ªën (COGS) - ƒê∆°n v·ªã: VNƒê</label>
                        <input type="number" id="cogs" value="100000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">Gi√° nh·∫≠p h√†ng/s·∫£n xu·∫•t</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="fixed_cost">Chi ph√≠ c·ªë ƒë·ªãnh/ƒê∆°n - ƒê∆°n v·ªã: VNƒê</label>
                        <input type="number" id="fixed_cost" value="20000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">L∆∞∆°ng, m·∫∑t b·∫±ng (ph√¢n b·ªï)</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="list_price">Gi√° ni√™m y·∫øt</label>
                        <input type="number" id="list_price" value="300000" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">Gi√° b√°n hi·ªán t·∫°i tr√™n c√°c k√™nh online</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" for="target_margin"> L√£i r√≤ng k·ª≥ v·ªçng (%)</label>
                        <input type="number" id="target_margin" value="30" class="w-full" oninput="calculateProfit()">
                        <p class="text-xs text-gray-500 mt-1">% l√£i r√≤ng k·ª≥ v·ªçng</p>
                    </div>
                </div>
            </div>

            <div class="card bg-white p-6 md:p-8 overflow-x-auto">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    2. SO S√ÅNH V√Ä M√î PH·ªéNG L√ÉI R√íNG THEO K√äNH B√ÅN H√ÄNG
                </h2>
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr class="text-gray-500 text-left text-sm uppercase tracking-wider bg-gray-50">
                            <th class="px-3 py-3 font-semibold w-1/4">Ch·ªâ S·ªë</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">Shopee</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">TikTok</th>
                            <th class="px-3 py-3 font-semibold w-1/4 text-center">OWNED CHANNEL</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 text-sm">
                        
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Ph√≠ s√†n / Hoa h·ªìng (%)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_a" value="10" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_b" value="2" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="fee_c" value="5" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Chi ph√≠ marketing/ƒê∆°n (VNƒê)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_a" value="20000" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_b" value="50000" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="mkt_c" value="0" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>
                        <tr>
                            <td class="px-3 py-4 font-medium text-gray-900">Discount √°p d·ª•ng (%)</td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_a" value="0" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_b" value="0" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                            <td class="px-3 py-2 text-center">
                                <input type="number" id="discount_c" value="20" class="w-24 text-center" oninput="calculateProfit()">
                            </td>
                        </tr>

                        <tr class="bg-indigo-50 font-bold">
                            <td class="px-3 py-4 text-indigo-700">Gi√° ho√† v·ªën</td>
                            <td class="px-3 py-4 text-center" id="bep_a"></td>
                            <td class="px-3 py-4 text-center" id="bep_b"></td>
                            <td class="px-3 py-4 text-center" id="bep_c"></td>
                        </tr>
                        <tr class="bg-red-50 font-bold">
                            <td class="px-3 py-4 text-red-700">M·ª©c gi√° b√°n l·∫ª m·ª•c ti√™u (TSP)</td>
                            <td class="px-3 py-4 text-center" id="tsp_a"></td>
                            <td class="px-3 py-4 text-center" id="tsp_b"></td>
                            <td class="px-3 py-4 text-center" id="tsp_c"></td>
                        </tr>
                        <tr class="bg-green-100 font-bold">
                            <td class="px-3 py-4 text-green-700">L√£i r√≤ng d·ª± ki·∫øn/ƒê∆°n</td>
                            <td class="px-3 py-4 text-center" id="net_profit_a"></td>
                            <td class="px-3 py-4 text-center" id="net_profit_b"></td>
                            <td class="px-3 py-4 text-center" id="net_profit_c"></td>
                        </tr>
                        <tr>
                             <td class="px-3 py-4 text-gray-900 font-medium">T·ª∑ l·ªá l√£i r√≤ng d·ª± ki·∫øn (%)</td>
                            <td class="px-3 py-4 text-center" id="net_margin_a"></td>
                            <td class="px-3 py-4 text-center" id="net_margin_b"></td>
                            <td class="px-3 py-4 text-center" id="net_margin_c"></td>
                        </tr>
                    </tbody>
                </table>
            </div>


            <div class="card bg-white p-6 md:p-8">
                <h2 class="text-xl font-bold text-indigo-700 mb-6 border-b pb-2">
                    3. M·ª®C DISCOUNT T·ªêI ∆ØU V√Ä D·ª∞ B√ÅO L·ª¢I NHU·∫¨N
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 items-stretch">
                    
                    <div id="discount_card_b" class="metric-card p-6 text-center md:col-span-2 bg-green-50 border-green-300">
                        <p class="text-sm font-semibold text-green-700 mb-2 uppercase">DISCOUNT T·ªêI ƒêA CHO PH√âP T·∫†I K√äNH RI√äNG</p>
                        <p class="text-4xl sm:text-5xl font-extrabold text-green-800" id="max_discount_b">0 VNƒê (0%)</p>
                        <p class="text-base text-gray-600 mt-2">M·ª©c gi·∫£m gi√° t·ªëi ƒëa so v·ªõi Gi√° ni√™m y·∫øt c√≥ th·ªÉ √°p d·ª•ng ƒë·ªÉ ƒë·∫°t L√£i r√≤ng k·ª≥ v·ªçng.</p>
                    </div>
                    
                    <div id="alert_card_c" class="metric-card p-6 text-center bg-yellow-50 border-yellow-300">
                        <p class="text-sm font-semibold text-yellow-700 mb-2">K·∫æT QU·∫¢</p>
                        <p class="text-3xl font-extrabold text-red-600" id="loss_alert">C√ì L√ÉI</p>
                        <p class="text-xs text-gray-500 mt-1">L√£i r√≤ng th·ª±c t·∫ø n·∫øu b√°n v·ªõi m·ª©c discount m√† b·∫°n ƒë∆∞a ra</p>
                    </div>

                    <div class="metric-card default p-4 text-center md:col-span-1 h-full">
                        <p class="text-sm font-semibold text-indigo-500 mb-1">L√ÉI R√íNG CH√äNH L·ªÜCH (Uplift)</p>
                        <p class="text-3xl font-extrabold text-indigo-700" id="profit_uplift">0 VNƒê</p>
                        <p class="text-xs text-gray-500 mt-1">Kho·∫£n l√£i tƒÉng th√™m khi k√©o 1 ƒë∆°n h√†ng t·ª´ S√†n v·ªÅ Owned Channel</p>
                    </div>
                    
                    <div class="md:col-span-2 bg-indigo-50 border border-indigo-200 p-6 rounded-lg text-center h-full">
                        <p class="text-lg font-bold text-indigo-800 mb-3">T·ªëi ∆∞u L√ÉI R√íNG CH√äNH L·ªÜCH v·ªõi Mesbox AI!</p>
                        <p class="text-gray-700 mb-4">
                            M·ª©c discount t·ªëi ƒëa c·∫ßn ƒë∆∞·ª£c √°p d·ª•ng m·ªôt c√°ch linh ho·∫°t v√† c√° nh√¢n h√≥a cho t·ª´ng t·∫≠p kh√°ch h√†ng. <span class="font-semibold">Mesbox AI Agent</span> t·ª± ƒë·ªông t∆∞ v·∫•n m·ª©c gi√° t·ªëi ∆∞u, h·ªó tr·ª£ ch·ªët ƒë∆°n v·ªõi gi√° tr·ªã cao h∆°n tr√™n Owned Channel, ƒë·ªìng th·ªùi s·ª≠ d·ª•ng d·ªØ li·ªáu h√†nh vi c·ªßa kh√°ch h√†ng ƒë·ªÉ li√™n t·ª•c c·∫£i thi·ªán ch·ªâ s·ªë L√£i R√≤ng Ch√™nh L·ªách.
                        </p>
                        <a href="https://mesbox.com/" class="inline-block px-6 py-3 bg-indigo-600 text-white font-bold rounded-full hover:bg-indigo-700 transition duration-300">
                            T√¨m hi·ªÉu v·ªÅ Mesbox AI Agent ‚Üí
                        </a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá Vi·ªát Nam (VNƒê)
        const formatCurrency = (number) => {
            if (isNaN(number) || number === null) return 'N/A';
            // L√†m tr√≤n ƒë·∫øn h√†ng ngh√¨n g·∫ßn nh·∫•t ƒë·ªÉ d·ªÖ ƒë·ªçc
            const roundedNumber = Math.round(number / 1000) * 1000;
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(roundedNumber).replace('‚Ç´', ' VNƒê');
        };

        // H√†m t√≠nh to√°n c·ªët l√µi
        const calculateProfit = () => {
            // L·∫•y d·ªØ li·ªáu Input Trung T√¢m
            const cogs = parseFloat(document.getElementById('cogs').value) || 0;
            const fixedCost = parseFloat(document.getElementById('fixed_cost').value) || 0;
            const listPrice = parseFloat(document.getElementById('list_price').value) || 0;
            // Target Margin Rate ph·∫£i ƒë∆∞·ª£c chia 100
            const targetMarginRate = (parseFloat(document.getElementById('target_margin').value) || 0) / 100;
            
            // C√†i ƒë·∫∑t Thu·∫ø (Simplification: Fixed 1.5% for all scenarios based on common tax rates for small sellers)
            // L∆∞u √Ω: Thu·∫ø l√† 1.5% d·ª±a tr√™n Doanh thu (Gi√° b√°n th·ª±c t·∫ø)
            const taxRate = 0.015; 

            // L·∫•y d·ªØ li·ªáu Bi·∫øn ƒê·ªïi K√™nh
            const scenarios = {
                a: { // K√™nh A (Shopee)
                    fee: (parseFloat(document.getElementById('fee_a').value) || 0) / 100, // Ph√≠ s√†n/HH (%)
                    mkt: parseFloat(document.getElementById('mkt_a').value) || 0, // Chi ph√≠ MKT (VNƒê)
                    discount: (parseFloat(document.getElementById('discount_a').value) || 0) / 100 // Discount √°p d·ª•ng (%)
                },
                b: { // K√™nh B (TikTok)
                    fee: (parseFloat(document.getElementById('fee_b').value) || 0) / 100, 
                    mkt: parseFloat(document.getElementById('mkt_b').value) || 0,
                    discount: (parseFloat(document.getElementById('discount_b').value) || 0) / 100
                },
                c: { // K√™nh C (Owned Channel)
                    fee: (parseFloat(document.getElementById('fee_c').value) || 0) / 100, 
                    mkt: parseFloat(document.getElementById('mkt_c').value) || 0,
                    discount: (parseFloat(document.getElementById('discount_c').value) || 0) / 100
                },
            };

            const results = {};

            // --- V√≤ng l·∫∑p t√≠nh to√°n cho t·ª´ng K·ªãch B·∫£n (A, B, C) ---
            for (const key in scenarios) {
                const s = scenarios[key];
                
                // 1. Gi√° b√°n th·ª±c t·∫ø sau khi √°p d·ª•ng discount
                const sellingPrice = listPrice * (1 - s.discount);

                // 2. T·ªïng Chi Ph√≠ C·ªê ƒê·ªäNH/ƒê∆°n (V·ªën + V·∫≠n H√†nh + MKT)
                const totalCostBasis = cogs + fixedCost + s.mkt;

                // 3. T·ªïng T·ª∑ L·ªá Ph√≠ Bi·∫øn ƒê·ªïi (Ph√≠ S√†n/Hoa H·ªìng + Thu·∫ø)
                const totalVariableFeeRate = s.fee + taxRate;
                // Ph√≠ bi·∫øn ƒë·ªïi (VNƒê) = Gi√° b√°n th·ª±c t·∫ø * T·ªïng t·ª∑ l·ªá ph√≠ bi·∫øn ƒë·ªïi
                const variableFees = sellingPrice * totalVariableFeeRate;

                // 4. L√£i R√≤ng Th·ª±c T·∫ø (NET PROFIT)
                // L√£i R√≤ng = Gi√° b√°n th·ª±c t·∫ø - Chi ph√≠ C·ªê ƒê·ªäNH - Ph√≠ BI·∫æN ƒê·ªîI
                const netProfit = sellingPrice - totalCostBasis - variableFees;

                // 5. T·ª∑ l·ªá L√£i R√≤ng Th·ª±c T·∫ø (%)
                const netMargin = (netProfit / sellingPrice) * 100;

                // 6. Gi√° Ho√† V·ªën (Break-Even Price - BEP)
                // BEP = Total Cost Basis / (1 - Total Variable Fee Rate)
                const bep = totalCostBasis / (1 - totalVariableFeeRate);

                // 7. Gi√° B√°n C·∫¶N ƒê·∫°t L√£i R√≤ng M·ª•c Ti√™u (Target Selling Price - TSP)
                // TSP = Total Cost Basis / (1 - Total Variable Fee Rate - Target Margin Rate)
                let tsp = NaN;
                if ((1 - totalVariableFeeRate - targetMarginRate) > 0) {
                    tsp = totalCostBasis / (1 - totalVariableFeeRate - targetMarginRate);
                }


                results[key] = {
                    netProfit: netProfit,
                    netMargin: netMargin,
                    bep: bep,
                    tsp: tsp,
                    sellingPrice: sellingPrice
                };

                // Hi·ªÉn th·ªã k·∫øt qu·∫£ v√†o B·∫£ng
                document.getElementById(`bep_${key}`).textContent = formatCurrency(bep);
                document.getElementById(`tsp_${key}`).textContent = formatCurrency(tsp);
                
                // Hi·ªÉn th·ªã L√£i R√≤ng Th·ª±c T·∫ø
                const profitEl = document.getElementById(`net_profit_${key}`);
                profitEl.textContent = formatCurrency(netProfit);
                profitEl.classList.toggle('text-red-600', netProfit < 0);
                profitEl.classList.toggle('text-green-700', netProfit >= 0);

                // Hi·ªÉn th·ªã T·ª∑ l·ªá L√£i R√≤ng
                document.getElementById(`net_margin_${key}`).textContent = `${netMargin.toFixed(1)}%`;
            }

            // --- C·∫≠p nh·∫≠t Khu V·ª±c 3: Quy·∫øt ƒê·ªãnh ---

            // Gi·∫£ ƒë·ªãnh K√™nh A (Shopee) l√† k√™nh ti√™u chu·∫©n ƒë·ªÉ so s√°nh Uplift
            // Gi·∫£ ƒë·ªãnh K√™nh C (Owned Channel) l√† k√™nh ƒë∆∞·ª£c quan t√¢m nh·∫•t cho Discount T·ªëi ƒêa

            // 1. L√ÉI R√íNG CH√äNH L·ªÜCH (Uplift: K√™nh C - K√™nh A)
            const profitUplift = results.c.netProfit - results.a.netProfit;
            document.getElementById('profit_uplift').textContent = formatCurrency(profitUplift);
            document.getElementById('profit_uplift').parentElement.classList.toggle('bg-red-50', profitUplift < 0);
            document.getElementById('profit_uplift').parentElement.classList.toggle('bg-green-50', profitUplift > 0);
            
            // 2. Discount T·ªëi ƒêa Cho Ph√©p (K√™nh C)
            const maxDiscountValue = listPrice - results.c.tsp;
            const maxDiscountPercent = (maxDiscountValue / listPrice) * 100;
            
            const discountCard = document.getElementById('discount_card_b');
            
            if (maxDiscountValue <= 0 || isNaN(maxDiscountValue)) {
                // Ph·∫£i b√°n cao h∆°n gi√° ni√™m y·∫øt ƒë·ªÉ ƒë·∫°t target margin HO·∫∂C kh√¥ng th·ªÉ ƒë·∫°t target
                discountCard.classList.remove('bg-green-50', 'border-green-300');
                discountCard.classList.add('bg-red-100', 'border-red-400');
                if (maxDiscountValue < 0) {
                    document.getElementById('max_discount_b').textContent = `PH·∫¢I TƒÇNG GI√Å! (${formatCurrency(-maxDiscountValue)})`;
                } else {
                    document.getElementById('max_discount_b').textContent = `KH√îNG ƒê·∫†T L√ÉI K·ª≤ V·ªåNG`;
                }
            } else {
                const maxDiscountText = `${formatCurrency(maxDiscountValue)} (${maxDiscountPercent.toFixed(1)}%)`;
                discountCard.classList.remove('bg-red-100', 'border-red-400');
                discountCard.classList.add('bg-green-50', 'border-green-300');
                document.getElementById('max_discount_b').textContent = maxDiscountText;
            }
            
            // 3. C·∫£nh B√°o K·ªãch B·∫£n C
            const lossAlertEl = document.getElementById('loss_alert');
            const alertCard = document.getElementById('alert_card_c');
            
            if (results.c.netProfit < 0) {
                lossAlertEl.textContent = 'L·ªñ N·∫∂NG!';
                lossAlertEl.classList.remove('text-red-600');
                lossAlertEl.classList.add('text-white');
                alertCard.classList.remove('bg-yellow-50', 'border-yellow-300');
                alertCard.classList.add('bg-red-600', 'border-red-700');
            } else {
                lossAlertEl.textContent = 'C√ì L√ÉI';
                lossAlertEl.classList.remove('text-white');
                lossAlertEl.classList.add('text-green-700');
                alertCard.classList.remove('bg-red-600', 'border-red-700');
                alertCard.classList.add('bg-green-50', 'border-green-300');
            }
        };

        // Ch·∫°y l·∫ßn ƒë·∫ßu khi t·∫£i trang
        window.onload = function() {
            calculateProfit();
        };

    </script>
</body>
</html>